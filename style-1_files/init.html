<!DOCTYPE html>
<!-- saved from url=(0086)https://www.w3spaces-preview.com/init.html?path=sprojects/Project1/staticwebpage1.html -->
<html style="overflow: hidden;"><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1252">

    <link href="./css" rel="stylesheet" type="text/css">
        <style>
            .main {
                padding: 50px;
                color: #282A35;
            }
            .header {
                font-family: Source Sans Pro;
                font-size: 24px;
                font-weight: 600;
                line-height: 23px;
                letter-spacing: 0px;
                text-align: left;
                padding-bottom: 16px;
            }
            .small-header {
                font-family: Source Sans Pro;
                font-size: 18px;
                font-weight: 600;
                line-height: 23px;
                letter-spacing: 0px;
                text-align: left;
                padding-bottom: 16px;
            }
            .numbertext {
                margin-left: 45px;
                padding-top: 3px;
            }
            .text {
                font-family: Source Sans Pro;
                font-size: 18px;
                font-weight: 300;
                line-height: 23px;
                letter-spacing: 0px;
                text-align: left;
                padding-bottom: 16px;
            }
            .infobar {
                padding-top: 18px;
            }
            .infobartext {
                padding-left: 20px;
                margin-top: -9px;
            }
            .bar {
                position: absolute;
                width: 4px;
                height: 63px;
                border-radius: 2px;
                background-color: #d9eee1;
                margin-top: -18px;
            }
            button {
                color: #fff;
                background-color: #04aa6d;
                margin-left: 40px;
                margin-top: 8px;
                margin-bottom: 23px;
                font-family: Source Sans Pro,sans-serif;
                font-size: 18px;
                font-weight: 600;
                font-stretch: normal;
                font-style: normal;
                line-height: 1.17;
                letter-spacing: normal;
                text-align: center;
                white-space: nowrap;
                position: relative;
                cursor: pointer;
                height: 50px;
                padding-left: 40px;
                padding-right: 40px;
                border-radius: 25px;
                border: 0;
                box-sizing: border-box;
                display: inline-block;
                text-decoration: none;
            }
            button:hover {
                background-color: #059862;
            }
            .horizontal-line {
                border-top: 1px solid #E2E8EA;
                border-bottom: 0px;
                margin-bottom: 20px;
            }
            .number-background {
                position: absolute;
                border-radius: 50%;
                width: 25px;
                height: 25px;
                background: #E2E8EA;
                border: 2px solid #E2E8EA;
                text-align: center;
                font-size: 18px;
                font-weight: 600;
            }
            .external-link-wrapper {
                padding-right: 25px;
            }
            .external-link {
                position: absolute;
                padding-left: 8px;
                top: 15px;
            }
        </style>

    <script>

        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        const baseUrl = new URL(window.location.href).host.replace("www.","");
        let spacePath = "";
        let cookies = [];
        let firstCookieSet = false;

        let actionOnLoad = 0;
        let initiateLoadPageFromEditor = false;

        const isCorrectDomain = (domain) => {
            return (domain === 'https://spaces-local.w3schools.com:3000' || domain === 'https://videos-dev.w3schools.com' || domain === 'https://spaces-dev.w3schools.com' || domain === 'https://spaces-stage.w3schools.com' || domain === 'https://spaces.w3schools.com');
        }

        const getCookie = name => {
            let v = document.cookie.match('(^|;) ?' + name + '=([^;]*)(;|$)');
            return v ? v[2] : null;
        }

        const openAsFirstParty = () => {
            window.open(`https://${new URL(window.location.href).host}/p.html`, "_blank", "width=670,height=430");
        }

        function prepareRequestWithUserGesture () {         
            firstCookieSet = true;
        }
        
        function makeRequestWithUserGesture () {    
            if(firstCookieSet) {
                document.requestStorageAccess()
                .then(
                    () => {
                        setTimeout(() => {
                        document.getElementById("contentFrame").style.display = "inline";
                        loadContent(
                            {
                                location: spacePath,
                                cookies: cookies
                            }
                        );
                        document.getElementById('activatepreview').style.display = "none";
                        }, 2000);
                    },
                    () => {
                        console.log("User denied storing cookies");
                        window.parent.postMessage("spaces.preview.use.fallback", "*");
                    }
                );
            }
        }

        const bindEvent = (element, eventName, eventHandler) => {
            if (element.addEventListener) {
                element.addEventListener(eventName, eventHandler, false);
            } else if (element.attachEvent) {
                element.attachEvent('on' + eventName, eventHandler);
            }
        }

        const unbindEvent = (element, eventName, eventHandler) => {
            if (element.removeEventListener) {
                element.removeEventListener(eventName, eventHandler, false);
            } else if (element.attachEvent) {
                element.detachEvent('on' + eventName, eventHandler);
            }
        }

        const loadContent = (data) => {
            actionOnLoad = data.scrollpos;
            if (data.cookies && data.cookies.length > 0) {
                let now = new Date();
                now.setTime(now.getTime() + 1 * 3600 * 24 * 365 * 1000);
                document.cookie = "Spaces-Preview=initialized; expires=" + now.toUTCString() + "; path=/";
                for(i=0;i<data.cookies.length;i++) {
                    document.cookie = data.cookies[i];
                }
            }

            if (actionOnLoad === 1) {
                try {
                    localStorage.setItem("code_editor.iscrollpos", 0);    
                } catch (error) {
                    // noop
                }
            }

            loadSpace(data.location);
        }

        const messageFunction = (e) => {
            if (isCorrectDomain(e.origin)) {
                unbindEvent(window, 'message', messageFunction);
                const data = JSON.parse(e.data);
                
                spacePath = data.location;
                cookies = data.cookies;

                loadContent(data);
                
            }
            return;
        }

        bindEvent(window, 'message', messageFunction);


        const loadSpace = async (location) => {

            if (getCookie("CloudFront-Policy") && getCookie("CloudFront-Signature") && getCookie("CloudFront-Key-Pair-Id")) {
                document.getElementById("contentFrame").src = location;
            }

            let initUrl = 'about:blank';

            document.getElementById("contentFrame").addEventListener('load', e => {

                if (initUrl === 'about:blank' || initUrl === 'about:srcdoc') {
                    initUrl = document.getElementById("contentFrame").contentWindow.location.href;
                }

                if (document.getElementById("contentFrame").contentWindow.location.href === initUrl) {
                    // Only scroll if load page is initiated from the editor. This way we don't scroll page when a new page is loaded from clicking something on the page.
                    // Will only track scrolling on the main page loaded from editor, not on paged loaded by clicking on page so back and forward will work.
                    let top = 0;
                    try {
                        top = localStorage.getItem("code_editor.iscrollpos");
                    } catch (error) {
                        // noop
                    }
                    document.getElementById("contentFrame").contentWindow.scrollTo({ left: 0, top: top, behavior: "instant" });

                    e.target.contentWindow.addEventListener('scroll', e => {
                        try {
                            localStorage.setItem("code_editor.iscrollpos", e.target.defaultView.scrollY);    
                        } catch (error) {
                            // noop                            
                        }
                    });
                }
            });
        };
    </script>
</head>

<body>

    <iframe src="./staticwebpage1.html" style="width:100%;height:99vh;border:0;" id="contentFrame"></iframe>

    <script>
        const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);

        if(isSafari && !(getCookie("CloudFront-Policy") && getCookie("CloudFront-Signature") && getCookie("CloudFront-Key-Pair-Id"))) {
            const externalLinkIcon = `<span class="external-link-wrapper"><svg class="external-link" width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M13.5 9.5H13C12.8674 9.5 12.7402 9.55268 12.6464 9.64645C12.5527 9.74021 12.5 9.86739 12.5 10V14.8125C12.5 14.8622 12.4802 14.9099 12.4451 14.9451C12.4099 14.9802 12.3622 15 12.3125 15H1.6875C1.63777 15 1.59008 14.9802 1.55492 14.9451C1.51975 14.9099 1.5 14.8622 1.5 14.8125V4.1875C1.5 4.13777 1.51975 4.09008 1.55492 4.05492C1.59008 4.01975 1.63777 4 1.6875 4H6.5C6.63261 4 6.75979 3.94732 6.85355 3.85355C6.94732 3.75979 7 3.63261 7 3.5V3C7 2.86739 6.94732 2.74021 6.85355 2.64645C6.75979 2.55268 6.63261 2.5 6.5 2.5H1.5C1.10218 2.5 0.720644 2.65804 0.43934 2.93934C0.158035 3.22064 0 3.60218 0 4L0 15C0 15.3978 0.158035 15.7794 0.43934 16.0607C0.720644 16.342 1.10218 16.5 1.5 16.5H12.5C12.8978 16.5 13.2794 16.342 13.5607 16.0607C13.842 15.7794 14 15.3978 14 15V10C14 9.86739 13.9473 9.74021 13.8536 9.64645C13.7598 9.55268 13.6326 9.5 13.5 9.5ZM15.625 0.5H11.375C11.3009 0.500065 11.2284 0.522094 11.1668 0.563304C11.1052 0.604514 11.0572 0.663057 11.0289 0.731538C11.0005 0.80002 10.9931 0.875369 11.0075 0.948068C11.022 1.02077 11.0576 1.08756 11.11 1.14L12.6159 2.64656L4.10969 11.1528C4.07473 11.1877 4.04699 11.229 4.02806 11.2746C4.00913 11.3202 3.99939 11.3691 3.99939 11.4184C3.99939 11.4678 4.00913 11.5167 4.02806 11.5622C4.04699 11.6078 4.07473 11.6492 4.10969 11.6841L4.81687 12.3912C4.85171 12.4262 4.89311 12.4539 4.93869 12.4729C4.98427 12.4918 5.03314 12.5015 5.0825 12.5015C5.13186 12.5015 5.18073 12.4918 5.22631 12.4729C5.27189 12.4539 5.31329 12.4262 5.34812 12.3912L13.8544 3.88469L15.3609 5.39094C15.4135 5.44305 15.4803 5.47845 15.5529 5.49268C15.6255 5.50691 15.7007 5.49933 15.7691 5.47089C15.8374 5.44246 15.8958 5.39444 15.9369 5.33289C15.978 5.27134 15.9999 5.19901 16 5.125V0.875C16 0.775544 15.9605 0.680161 15.8902 0.609835C15.8198 0.539509 15.7245 0.5 15.625 0.5V0.5Z" fill="white"/>
                                     </svg></span>`;

            const infoText = `<div id='activatepreview' class='main'>
                            <div class='header'>Cookies required to use preview in Safari</div>
                            <div class='text'>To avoid using requests every time you preview your code here in Safari, you will need to allow this url to use cookies and website data on this device.</div>
                            <hr class='horizontal-line'>
                            <div class='small-header'>To enable preview:</div>
                            <div class='text'>
                                <div class='number-background'>1</div>
                                <div class='numbertext'>Click the button below, to open the url in a new window.</div>                        
                            </div>
                            <button id='openAsFirstParty' onclick='openAsFirstParty();'>Open url in new window ${externalLinkIcon}</button>
                            <hr class='horizontal-line'>
                            <div class='text'>
                                <div class='number-background'>2</div>
                                <div class='numbertext'>In the new window, click the button "Continue" to close the window and come back here.</div>                        
                            </div>
                            <hr class='horizontal-line'>
                            <div class='text'>
                                <div class='number-background'>3</div>
                                <div class='numbertext'>Click the button below, to trigger the settings to allow this url to use cookies.</div>                        
                            </div>
                            <button id='makeRequestWithUserGesture' onclick='makeRequestWithUserGesture();'>Show settings for cookies  ${externalLinkIcon}</button>
                            <hr class='horizontal-line'>
                            <div class='text'>
                                <div class='number-background'>4</div>
                                <div class='numbertext'>Click the button "Allow" in the window that appears, to approve this url to use cookies  - and to enable preview.</div>                        
                            </div>
                            <hr class='horizontal-line'>
                            <div class='text'>Thats it! When you have completed all these steps, you will see the preview of your space here instead.</div>
                            <div class='infobar'>
                                <div class='bar'></div>
                                <div class='text infobartext'>
                                    <strong>Note:</strong> When using Safari, you will need to repeat this process when you start a new session.
                                </div>
                            </div>
                        </div>`;

            document.hasStorageAccess()
            .then(
                (hasAccess) => {
                    if(!getCookie("Spaces-Preview")) {
                        document.getElementsByTagName("html")[0].style.overflow = "scroll";
                        document.getElementById("contentFrame").style.display = "none";
                        document.getElementById("contentFrame").insertAdjacentHTML("beforebegin", infoText);
                    }
                },
                (reason) => {
                    document.getElementsByTagName("html")[0].style.overflow = "scroll";
                    document.getElementById("contentFrame").style.display = "none";
                    document.getElementById("contentFrame").insertAdjacentHTML("beforebegin", infoText);
                }
            );
            
        }

        if (getCookie("CloudFront-Policy") && getCookie("CloudFront-Signature") && getCookie("CloudFront-Key-Pair-Id")) {
            window.parent.postMessage("private.content.window.loaded", "*");
        }
        else {
            window.parent.postMessage("private.content.window.loaded.nocookies", "*");
        }

    </script>




</body></html>